<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>ç”¨æˆ·æŸ¥è¯¢</title>
    <script src="../jslib/jquery-2.1.1.min.js"></script>
    <script src="../jslib/bootstrap/bootstrap-bootbox/bootbox.js"></script>
    <script src="../jslib/bootstrap/bootstrap3/js/bootstrap.js"></script>
    <link rel="stylesheet" href="../jslib/bootstrap/bootstrap3/css/bootstrap.css"/>

    <link rel="stylesheet" href="../jslib/bootstrap/bootstrap-table/bootstrap-table.css"/>
    <script src="../jslib/bootstrap/bootstrap-table/bootstrap-table.js"></script>
    <script src="../jslib/bootstrap/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
</head>
<body>

<!-- æ¡æŸ¥  -->
<div id="toolbar">
    <form class="form-inline">
        <div class="container">
            <div class="form-group" style="float: left;margin-left: 10px">
                <label for="username">ç”¨æˆ·åç§°</label>
                <input type="text" class="form-control" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·åç§°"/>
            </div>
            <div class="dropdown" style="float: left;margin-left: 10px">
                <button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown">æ‰‹æœºå·
                    <span class="caret"></span></button>
                    <ul class="dropdown-menu" id="phoneHtml" role="menu" aria-labelledby="menu1">

                    </ul>
                <button type="button" onclick="searchUser()" class="btn btn-info glyphicon glyphicon-search">æœç´¢</button>
            </div>
        </div>
        <!--<div class="form-group">
        </div>-->
    </form>
</div>
<!--ä¿®æ”¹å¯†ç å¼¹æ¡†-->
<div class="modal fade" id="myModal2" role="dialog" >
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">Ã—
                </button>
                <form id="userForm">
                    <!--æäº¤-->
                    <div id="tijiao" style="display: block">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-sm-3"></div>
                                <div class="col-sm-7"><h4>ä¿®æ”¹å¯†ç </h4></div>
                            </div><br/>
                            <div class="row">
                                <div class="col-sm-2">è´¦å·</div>
                                <div class="col-sm-6">
                                    <input type="text"  class="form-control" id="username2" />
                                    <input type="hidden"  class="form-control" id="id" name="id" />
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-sm-2">æ–°å¯†ç </div>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control"  name="password"/>
                                </div>
                            </div>
                            <br/>
                            <!--                          <div class="row">
                                                          <center><font size="3px" color="#008b8b">å…è´¹å’¨è¯¢400-069-6530</font><br/>

                                                              ç™»å½•å³è§†ä¸ºåŒæ„ã€Šç”¨æˆ·ä½¿ç”¨åè®®ã€‹åŠã€Šéšç§æƒæ¡æ¬¾ã€‹</center>
                                                      </div>-->

                        </div>
                    </div>

                </form>
                <div class="modal-footer">
                    <center>
                        <button type="button" onclick="update()" class="btn btn-primary" style="display: block" id="logins" >
                            ç¡®è®¤ä¿®æ”¹
                        </button>
                    </center>
                </div>
            </div>
        </div>
    </div>
</div>


<table id="myTable"></table>

</body>

<!--<script>
    //æŒ‡å®š1ç§’åˆ·æ–°ä¸€æ¬¡
    function myrefresh(){
        window.location.reload();
    }
    setTimeout('myrefresh()',1000); //æŒ‡å®š1ç§’åˆ·æ–°ä¸€æ¬¡
</script>-->
<script>
    //åˆå§‹åŒ–é¡µé¢
    $(function(){
        initMyTable();
        initUserPhone();
    })

    //ä¿®æ”¹å¯†ç 
    function updatePs(id,username){
        //alert(username);
        $("#myModal2").modal("show");
        $("#id").val(id);
        $("#username2").val(username);
    }
    //ç¡®è®¤ä¿®æ”¹
    function update(){
        $.post('../updatePss',$("#userForm").serialize(),function(){
            bootbox.alert({
                size: "small",
                title: "æç¤º",
                message: "ä¿®æ”¹æˆåŠŸ",
            });
            $("#myTable").bootstrapTable("refresh", {
                silent: true //é™æ€åˆ·æ–°
            });
        })
    }


    function initUserPhone() {
        $.ajax({
            url : "../initUserPhone",
            async : true,
            type: "POST",
            dataType: "json",
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success : function(data) {
                console.info(data);
                $.each(data,function(i){
                    html1 = '<li role="presentation" ><a href=""></a></li>';
                    //html1 += '<option value="'+ data[i].phone +'"> '+ data[i].phone +' </option>';
                    html1 += '<li role="presentation" ><a href="###" id="phone"></a>'+ data[i].phone +'</li>';

                })
                //$('#phoneHtml').html(html1);
            },
            error : function(e){
                alert("ä»£ç æœ‰é—®é¢˜ï¼Œè¯·æ‰“å¼€F12å’Œdebugè¿›è¡Œè°ƒè¯•ï¼");
            }
        });
    }

    //å±•ç¤ºå†…å®¹
    function initMyTable(){
        $('#myTable').bootstrapTable({
            toolbar:'#toolbar',
            url:'../queryUserblackPageList',
            pagination:true, //æ˜¯å¦å±•ç¤ºåˆ†é¡µ
            pageList:[3,5,10,20],//åˆ†é¡µç»„ä»¶
            pageNumber:1,
            pageSize:3,//é»˜è®¤æ¯é¡µæ¡æ•°
            search:false,//æ˜¯å¦æ˜¾ç¤ºæœç´¢æ¡†
            searchText:'è¯•è¯•',//åˆå§‹åŒ–æœç´¢æ–‡å­—
            showColumns:false,//æ˜¯å¦æ˜¾ç¤º å†…å®¹åˆ—ä¸‹æ‹‰æ¡†
            showToggle:false,//æ˜¯å¦æ˜¾ç¤º åˆ‡æ¢è¯•å›¾ï¼ˆtable/cardï¼‰æŒ‰é’®
            showPaginationSwitch:false,//æ˜¯å¦æ˜¾ç¤º æ•°æ®æ¡æ•°é€‰æ‹©æ¡†
            showRefresh:false,//æ˜¯å¦æ˜¾ç¤ºåˆ·æ–°æŒ‰é’®
            detailView:false,//è®¾ç½®ä¸º true å¯ä»¥æ˜¾ç¤ºè¯¦ç»†é¡µé¢æ¨¡å¼ã€‚
            showFooter:false,//æ˜¯å¦æ˜¾ç¤ºåˆ—è„š
            clickToSelect: true, //æ˜¯å¦å¯ç”¨ç‚¹å‡»é€‰ä¸­è¡Œ
            sidePagination:'server',//åˆ†é¡µæ–¹å¼ï¼šclientå®¢æˆ·ç«¯åˆ†é¡µï¼ŒserveræœåŠ¡ç«¯åˆ†é¡µï¼ˆ*
            striped:true,
            queryParams:function(){              // æ¡æŸ¥
                var username = $('#username').val();
                //alert(username);
                //var phone = $('#phone').val();
                return {
                    page: this.pageNumber,
                    rows: this.pageSize,
                    username:username
                    /*phone:phone,*/
                }
            },
            columns:[
                {field:'id',title:'ğŸ‘¨'},
                {field:'username',title:'ğŸ‘¨ç”¨æˆ·åç§°'},
                {field:'phone',title:'ğŸ‘¨ç”¨æˆ·æ‰‹æœºå·'},
                {field:'password',title:'ğŸ‘¨ç”¨æˆ·å¯†ç '},
                {formatter:function(value,row,index){
                        return '<button type="button" Class="btn btn-default" onclick="UpdateUserStatus('+ row.id +')">å–æ¶ˆé»‘åå•</button><button type="button" Class="btn btn-default" onclick="deleteUserOne('+ row.id +')">åˆ é™¤ç”¨æˆ·</button><button type="button" Class="btn btn-default" onclick="UpdateUserStatusToStar('+ row.id +')">æ˜Ÿæ ‡ç”¨æˆ·</button><button type="button" style="height: 30px;width: 90px" onclick="updatePs('+row.id+',\''+row.username+'\')" class="btn btn-default">ä¿®æ”¹å¯†ç </button>';

                }}
            ]
        })
    }

    //æœç´¢
    function searchUser(){
        $('#myTable').bootstrapTable('refresh');
    }

    /**
     * è¿˜åŸç”¨æˆ·ä¿¡æ¯  ä¿®æ”¹çŠ¶æ€ä¸º1
     * @param id
     * @constructor
     */
    function UpdateUserStatus(id) {
        $.ajax({
            url : "../UpdateUserStatus?id="+id,
            async : true,
            type: "POST",
            processData: false,
            contentType:false,
            dataType: "json",
            success : function(data) {
                if(data == 1){
                    $('#myTable').bootstrapTable('refresh');
                }
            },
            error : function(e){
                alert("ä»£ç æœ‰é—®é¢˜ï¼Œè¯·æ‰“å¼€F12å’Œdebugè¿›è¡Œè°ƒè¯•ï¼");
            }
        });
    }

    /**
     * æ˜Ÿæ ‡ç”¨æˆ·  ä¿®æ”¹çŠ¶æ€ä¸º3
     * @param id
     * @constructor
     */
    function UpdateUserStatusToStar(id) {
        $.ajax({
            url : "../UpdateUserStatusToStar?id="+id,
            async : true,
            type: "POST",
            processData: false,
            contentType:false,
            dataType: "json",
            success : function(data) {
                if(data == 1){
                    $('#myTable').bootstrapTable('refresh');
                }
            },
            error : function(e){
                alert("ä»£ç æœ‰é—®é¢˜ï¼Œè¯·æ‰“å¼€F12å’Œdebugè¿›è¡Œè°ƒè¯•ï¼");
            }
        });
    }




    function deleteUserOne(id) {
        $.ajax({
            url : "../deleteUserOne?id="+id,
            async : true,
            type: "POST",
            processData: false,
            contentType:false,
            dataType: "json",
            success : function(data) {
                if(data == 1){
                    $('#myTable').bootstrapTable('refresh');
                }
            },
            error : function(e){
                alert("ä»£ç æœ‰é—®é¢˜ï¼Œè¯·æ‰“å¼€F12å’Œdebugè¿›è¡Œè°ƒè¯•ï¼");
            }
        });
    }
    
</script>
</html>